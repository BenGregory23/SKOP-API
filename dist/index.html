<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>API Wemed</title>
        <link rel="stylesheet" href="../style/global.css">
    </head>
 

    <body>
        <div id="main">
            <h1> API WEMED SAMPLE </h1>   
             <div class="buttons">
                <button id="patient" class="button" onclick="call('patient')">Patient</button>
                <button id="medecin" class="button" onclick="call('doctor')">Medecin</button>
                <!-- <button id="skop">SKOP</button> -->
                 <button id="conv">CONVERSATION</button>
                 <div id="div-select">
                    <select name="zones" id="zones">
                      <option class="zones-value" value="...">Heart Zones</option>  
                      <option class="zones-value" value="Aortic">Aortique</option>
                      <option class="zones-value" value="Mitral">Mitrale</option>
                      <option class="zones-value" value="Pulmonary">Pulmonaire</option>
                      <option class="zones-value" value="Tricuspid">Tricuspide</option>
                    </select> 
                 </div>
                <a id="download">Download</a>
             </div>
             <div id="div-range" >
                 <h4 id="gain-output">Gain : ... </h4>
                <input type="range" min="0" max="100" value="10" class="slider" id="gainRange">
            </div>
        
            <div id="infos"> </div>
        </div>
    </body>

    <script src="Skop.js"></script>
    <script>

        // ------------Récupération de données de session------------ //
        var apiKey
        var sessionId
        var token
    
        fetch("https://test-wemed.herokuapp.com/session")
        .then(data => data.json())
        .then(data => {
            apiKey = data.apiKey
            sessionId = data.sessionId
            token = data.token
        })
        // --------------------------------------------------------- //


    

        let buttonConversation  = document.getElementById("conv");
        let select = document.getElementById("zones");
        let infos = document.getElementById("infos");
        let buttonPatient = document.getElementById("patient");
        let buttonMedecin = document.getElementById("medecin");

        let divRange = document.getElementById("div-range")
        let gainRange = document.getElementById("gainRange");
        let gainOutput = document.getElementById("gain-output");

        let buttonDownload = document.getElementById("download");

        // Hiding the content that is for the doctor.
        buttonConversation.style.display   = "none";
        select.style.display              = "none";
        divRange.style.display = "none"

        buttonDownload.style.display = "none";

        
        function call(role){
            //Removing the previous button because the role is chosen.
            buttonPatient.remove();
            buttonMedecin.remove();

            let test = new Skop.Skop(apiKey, token, sessionId, role);

            if(test.getRole() === "doctor"){

                // Displaying the content that is for the doctor.
                buttonConversation.style.display   = "block";
                select.style.display              = "block";
               
                buttonConversation.addEventListener('click', () => {
                    test.signalStopUsingSkop();
                    test.skop();
                    divRange.style.display = "none"
                })
                select.addEventListener("change", (e) => {
                  
                    test.signalHeartZone(e.target.value);
                    divRange.style.display = "flex"
                });


                gainRange.oninput = function() {
                    gainOutput.innerHTML = "Gain : " + this.value;
                    test.signalGain(this.value);
                }


            }else if(test.getRole() === "patient"){
               
                buttonConversation.remove();
                select.remove();
                buttonDownload.style.display = "block";
             
            }

            // Display the role of the user
            infos.innerHTML = "ROLE : " + test.getRole() + "<br>";
        }            
    </script>
</html>