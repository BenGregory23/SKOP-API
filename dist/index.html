<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>API Wemed</title>
        <link rel="stylesheet" href="../style/global.css">
    </head>
 

    <body>
        <div id="main">
            <h1>
                API WEMED SAMPLE
             </h1>   
             <div id="infos"> </div>
             <div class="buttons">
                <button id="patient" class="button" onclick="call('patient')">Patient</button>
                <button id="medecin" class="button" onclick="call('doctor')">Medecin</button>
                <!-- <button id="skop">SKOP</button> -->
                 <button id="conv">CONVERSATION</button>
                 <div id="div-select">
                    <select name="zones" id="zones">
                      <option class="zones-value" value="...">Exemple</option>  
                      <option class="zones-value" value="Aortique">Aortique</option>
                      <option class="zones-value" value="Mitrale">Mitrale</option>
                      <option class="zones-value" value="Pulmonaire">Pulmonaire</option>
                      <option class="zones-value" value="Tricuspide">Tricuspide</option>
                    </select> 
                 </div>
                
             </div>
     
             <div id="current">Les informations sur l'utilisation du Skop seront affichées ici.</div>
        </div>
       
  
    </body>

    <script src="Skop.js"></script>
    <script>

        // ------------Récupération de données de session------------ //
        var apiKey
        var sessionId
        var token
    
        fetch("https://test-wemed.herokuapp.com/session")
        .then(data => data.json())
        .then(data => {
            apiKey = data.apiKey
            sessionId = data.sessionId
            token = data.token
        })
        // --------------------------------------------------------- //


    

        let buttonConversation  = document.getElementById("conv");
        let select = document.getElementById("zones");
        let container = document.getElementById("current");
        let infos = document.getElementById("infos");
        let buttonPatient = document.getElementById("patient");
        let buttonMedecin = document.getElementById("medecin");


        // Hiding the content that is for the doctor.
        buttonConversation.style.display   = "none";
        select.style.display              = "none";
        container.style.display           = "none";

        
        function call(role){
            //Removing the previous button because the role is chosen.
            buttonPatient.remove();
            buttonMedecin.remove();

            let test = new Skop.Skop(apiKey, token, sessionId, role);

            if(test.getRole() === "doctor"){

                // Displaying the content that is for the doctor.
                buttonConversation.style.display   = "block";
                select.style.display              = "block";
                container.style.display           = "block";

                buttonConversation.addEventListener('click', () => {
                  
                    test.signalToPatient("default");
                    container.innerHTML = "Mode : Conversation"; 
                })
                select.addEventListener("change", (e) => {
                    container.innerHTML = "Utilisation du Skop pour la zone  "  + e.target.value;
                    test.signalToPatient(e.target.value);
                });
            }else if(test.getRole() === "patient"){
               
                buttonConversation.remove();
                select.remove();
                container.remove();
             
            }

            // Display the role of the user
            infos.innerHTML = "Role : " + test.getRole() + "<br>";
        }            
    </script>
</html>