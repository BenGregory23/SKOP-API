<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>SKOP - Wemed </title>
        <link rel="stylesheet" href="./style/global.css">
        <meta content="width=device-width, initial-scale=1" name="viewport" />
        <link rel="shortcut icon" type="image/png" href="./ICO.png"/>
    </head>
    <body>
        <div id="main">
            <h1> API WEMED SAMPLE </h1>
             <div class="buttons">
                <button id="patient" class="button" onclick="call('patient')">Patient</button>
                <button id="doctor" class="button" onclick="call('doctor')">Medecin</button>
                 <button id="conv">CONVERSATION</button>
                 <div id="div-select">
                    <select name="zones" id="zones">
                      <option class="zones-value" value="...">Heart Zones</option>
                      <option class="zones-value" value="Aortic">Aortique</option>
                      <option class="zones-value" value="Mitral">Mitrale</option>
                      <option class="zones-value" value="Pulmonary">Pulmonaire</option>
                      <option class="zones-value" value="Tricuspid">Tricuspide</option>
                    </select>
                 </div>
             </div>
             <div id="div-range" >
                 <h4 id="gain-output">Gain : ... </h4>
                <input type="range" min="0" max="100" value="10" class="slider" id="gainRange">
            </div>


            <div id="div-canvas">
                <canvas id="canvas" width="200" height="400"></canvas>
            </div>


            <div id="infos"> </div>
            <div id="div-wemed">
                <a href="https://en.wemed.fr/" target="_blank" id="wemed">Check out WeMed! </a>
            </div>
        </div>
    </body>

    <script src="../dist/SkopAPI.js"></script>
    <script>


        // ------------Récupération de données de session------------ //

        let room = 45 // rooms are used to do one-to-one conversations, the room is the id of the conversation
        //TODO : récupérer les données de session depuis l'API si la clé d'API WEMED est valide
        var apiKey
        var sessionId
        var token
    
        fetch("https://test-wemed.herokuapp.com/room/" + room)
        .then(data => data.json())
        .then(data => {
            apiKey = data.apiKey
            sessionId = data.sessionId
            token = data.token
            
        })
        // ------------ --------------------------------------------- //

        let buttonPatient = document.getElementById("patient");
        let buttonMedecin = document.getElementById("doctor");
        let infos = document.getElementById("infos");

        let buttonConversation  = document.getElementById("conv");
        let select = document.getElementById("zones");
        let divRange = document.getElementById("div-range")
        let gainRange = document.getElementById("gainRange");
        let gainOutput = document.getElementById("gain-output");

        let canvas = document.getElementById("canvas");

        // Hiding the content that is for the doctor.
        buttonConversation.style.display   = "none";
        select.style.display               = "none";
        divRange.style.display            = "none"

        //Hiding the canvas
        canvas.style.display = "none";


        function call(role){
            //Removing the previous button because the role is chosen.
            buttonPatient.remove();
            buttonMedecin.remove();
            if(role === "doctor"){
                doctor();
            }else if(role === "patient"){
                patient();
            }
            // Display the role of the user
            infos.innerHTML = "ROLE : " + role + "<br>";
        }


        function patient(){
            buttonConversation.remove();
            select.remove();

            let patient = new SkopAPI.Patient(apiKey, token, sessionId);
            canvas.style.display = "block";
            canvas.style.position = "absolute";

        }


        function doctor(){
            let doctor = new SkopAPI.Doctor(apiKey, token, sessionId);
            // Displaying the content that is for the doctor.
            buttonConversation.style.display   = "block";
            select.style.display              = "block";

            buttonConversation.addEventListener('click', () => {
                doctor.skop();
                divRange.style.display = "none"
            })
            select.addEventListener("change", (e) => {
                doctor.skop(e.target.value);
                divRange.style.display = "flex"
            });


            gainRange.oninput = function() {
                gainOutput.innerHTML = "Gain  : " + this.value;
                doctor.changeGainLevel(this.value);
            }
        }
    </script>
</html>
